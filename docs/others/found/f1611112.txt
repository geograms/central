ay.setOnClickListener(v -> {
            FragmentManager fragmentManager = getSupportFragmentManager();
            FragmentTransaction transaction = fragmentManager.beginTransaction();
            transaction.replace(R.id.fragment_container, new RelayFragment()).addToBackStack(null);
            transaction.commit();
        });

        // Collections button
        ImageButton btnCollections = findViewById(R.id.btn_collections);
        btnCollections.setOnClickListener(v -> {
            FragmentManager fragmentManager = getSupportFragmentManager();
            FragmentTransaction transaction = fragmentManager.beginTransaction();
            transaction.replace(R.id.fragment_container, new CollectionsFragment()).addToBackStack(null);
            transaction.commit();
        });

        navigationView.setNavigationItemSelectedListener(item -> {
            FragmentManager fragmentManager = getSupportFragmentManager();
            FragmentTransaction transaction = fragmentManager.beginTransaction();

            if (item.getItemId() == R.id.nav_settings) {
                transaction.replace(R.id.fragment_container, SettingsFragment.getInstance()).addToBackStack(null);
            } else if (item.getItemId() == R.id.nav_connections) {
                transaction.replace(R.id.fragment_container, new ConnectionsFragment()).addToBackStack(null);
            // Relay menu removed - relay accessible via main action bar relay button
            // } else if (item.getItemId() == R.id.nav_relay) {
            //     transaction.replace(R.id.fragment_container, new RelayFragment()).addToBackStack(null);
            } else if (item.getItemId() == R.id.nav_debug) {
                transaction.replace(R.id.fragment_container, new DebugFragment()).addToBackStack(null);
            } else if (item.getItemId() == R.id.nav_about) {
                transaction.replace(R.id.fragment_container, new AboutFragment()).addToBackStack(null);
            }

            transaction.commit();
            drawerLayout.closeDrawer(GravityCompat.START);
            return true;
        });
    }

    private void setupBackPressedHandler() {
        this.getOnBackPressedDispatcher().addCallback(this, new OnBackPressedCallback(true) {
            @Override
            public void handleOnBackPressed() {
                FragmentManager fragmentManager = getSupportFragmentManager();
                if (fragmentManager.getBackStackEntryCount() > 0) {
                    fragmentManager.popBackStack();
                } else {
                    finish();
                }
            }
        });
    }

    @SuppressLint("ObsoleteSdkInt")
    private void startBackgroundService() {
        Intent serviceIntent = new Intent(this, BackgroundService.class);
        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {
            log(TAG, "Starting BackgroundService as a foreground service");
            startForegroundService(serviceIntent);
        } else {
            log(TAG, "Starting BackgroundService as a normal service");
            startService(serviceIntent);
        }
    }

    private void checkBluetoothStatus() {
        BluetoothAdapter bluetoothAdapter = BluetoothAdapter.getDefaultAdapter();
        if (bluetoothAdapter == null) {
            Toast.makeText(this, "Bluetooth is not supported on this device", Toast.LENGTH_LONG).show();
        } else if (!bluetoothAdapter.isEnabled()) {
            Toast.makeText(this, "Bluetooth is disabled. Please enable it", Toast.LENGTH_LONG).show();
        }
    }

    private void loadNearbyFragment() {
        FragmentManager fragmentManager = getSupportFragmentManager();
        FragmentTransaction transaction = fragmentManager.beginTransaction();
        transaction.replace(R.id.fragment_container, Central.getInstance().broadcastChatFragment);
        transaction.commit();
    }

    /**
     * Update the device count badge.
     * Only counts devices heard in the last 5 minutes.
     * Call this method whenever devices are added/removed.
     */
    public void updateDeviceCount() {
        Te