{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://geogram.example.com/schemas/security.json",
  "title": "Geogram Collection Security Schema",
  "description": "JSON Schema for Geogram security.json files",
  "type": "object",
  "required": [
    "version",
    "visibility",
    "permissions",
    "content_warnings",
    "age_restriction",
    "encryption"
  ],
  "properties": {
    "version": {
      "type": "string",
      "description": "Schema version",
      "pattern": "^\\d+\\.\\d+$",
      "examples": ["1.0"]
    },
    "visibility": {
      "type": "string",
      "description": "Access level",
      "enum": ["public", "private", "password", "group"]
    },
    "permissions": {
      "type": "object",
      "required": [
        "public_read",
        "allow_submissions",
        "submission_requires_approval",
        "can_users_comment",
        "can_users_like",
        "can_users_dislike",
        "can_users_rate",
        "whitelisted_users",
        "blocked_users"
      ],
      "properties": {
        "public_read": {
          "type": "boolean",
          "description": "Allow public read access"
        },
        "allow_submissions": {
          "type": "boolean",
          "description": "Allow user file submissions"
        },
        "submission_requires_approval": {
          "type": "boolean",
          "description": "Require owner approval for submissions"
        },
        "can_users_comment": {
          "type": "boolean",
          "description": "Allow users to comment"
        },
        "can_users_like": {
          "type": "boolean",
          "description": "Allow users to like"
        },
        "can_users_dislike": {
          "type": "boolean",
          "description": "Allow users to dislike"
        },
        "can_users_rate": {
          "type": "boolean",
          "description": "Allow users to rate (1-5 stars)"
        },
        "whitelisted_users": {
          "type": "array",
          "description": "Allowed user npubs",
          "items": {
            "type": "string",
            "pattern": "^npub1[a-z0-9]{58}$"
          },
          "uniqueItems": true
        },
        "blocked_users": {
          "type": "array",
          "description": "Blocked user npubs",
          "items": {
            "type": "string",
            "pattern": "^npub1[a-z0-9]{58}$"
          },
          "uniqueItems": true
        }
      }
    },
    "content_warnings": {
      "type": "array",
      "description": "Content warning tags",
      "items": {
        "type": "string",
        "minLength": 1,
        "maxLength": 50
      },
      "uniqueItems": true
    },
    "age_restriction": {
      "type": "object",
      "required": ["enabled", "minimum_age", "verification_required"],
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable age restriction"
        },
        "minimum_age": {
          "type": "integer",
          "description": "Minimum age requirement",
          "minimum": 0,
          "maximum": 120
        },
        "verification_required": {
          "type": "boolean",
          "description": "Require age verification (future)"
        }
      }
    },
    "encryption": {
      "type": "object",
      "required": ["enabled", "method", "encrypted_files"],
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable encryption (future)"
        },
        "method": {
          "type": ["string", "null"],
          "description": "Encryption method",
          "enum": [null, "aes-256-gcm", "chacha20-poly1305"]
        },
        "encrypted_files": {
          "type": "array",
          "description": "List of encrypted file paths (future)",
          "items": {
            "type": "string"
          }
        }
      }
    }
  }
}
